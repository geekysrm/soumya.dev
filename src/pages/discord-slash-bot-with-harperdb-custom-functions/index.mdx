---
title: "Create a Discord Slash Bot with HarperDB Custom Functions"
description: Learn how to create a Discord Slash Bot with HarperDB Custom Functions.
date: "2021-10-22"
tags: "javascript"
---

import Image from "../../components/Image";

<div>
  <p>Hello folks ðŸ‘‹!</p>
  <p>
    Have you ever created a Node.js server using Express/Fastify? Have you used
    a service like HarperDB to store your data?
  </p>
  <p>
    If yes, then you are in luck! HarperDB has introduced{" "}
    <a href="https://harperdb.io/docs/custom-functions/">Custom Functions</a>{" "}
    which helps us to use HarperDB methods to create our custom API endpoints.
    Custom Functions are written in Node.js and are powered by Fastify.
  </p>
  <p>
    HarperDB Custom Functions can be used to power things like integration with
    third-party apps and APIs, AI, third-party authentication, defining database
    functionality, and serving a website.
  </p>
  <p>
    All the things that we will cover in this tutorial are within the FREE tier
    of HarperDB.
  </p>
  <ul>
    <li>
      <em>
        If you want to review the code at any point,{" "}
        <a href="https://github.com/geekysrm/harperdb-discordbot">
          here is the GitHub repo
        </a>
      </em>{" "}
      .
    </li>
  </ul>
  <h2 id="what-are-we-going-to-build-">What are we going to build?</h2>
  <p>
    We will build a Discord bot which responds to{" "}
    <a href="https://support.discord.com/hc/en-us/articles/1500000368501-Slash-Commands-FAQ">
      slash commands
    </a>{" "}
    .
  </p>
  <p>
    Users can say a programming joke on the discord channel using{" "}
    <strong>/sayjoke</strong> command. We will keep count of the number of jokes
    each user has posted and the jokes in a HarperDB database.
  </p>
  <p>
    Any user can use the <strong>/top</strong> command to see who is the user
    who has posted the most programming jokes.
  </p>
  <p>
    And finally, one can view the jokes posted by a particular user by using the{" "}
    <strong>/listjokes</strong> command.
  </p>
  <p>
    Our bot will be able to fetch the data from the HarperDB database, perform
    some logic and respond to the user with the results.
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633465374445/Pv7ZWy7Ur.png"
      alt="tmppG9Not.png"
    />
    <em>A small demo of what we will be building</em>
  </p>
  <h2 id="prerequisites">Prerequisites</h2>
  <p>
    Before starting off with this tutorial, make sure you have the following:
  </p>
  <ul>
    <li>
      <a href="https://nodejs.org/">Node.js</a> and npm installed
    </li>
    <li>Basic JavaScript knowledge</li>
    <li>A discord.com account</li>
    <li>
      <a href="https://www.postman.com/">Postman</a> or other REST API Client
    </li>
    <li>
      A code editor like{" "}
      <a href="https://code.visualstudio.com/download">VS Code</a>
    </li>
    <li>
      A <a href="https://studio.harperdb.io/sign-up">HarperDB Account</a>
    </li>
  </ul>
  <h2 id="installation">Installation</h2>
  <p>
    We need to set up our local environment first. Make sure to use node{" "}
    <code>v14.17.3</code> to avoid errors during installation. So we will
    install the HarperDB package from <code>npm</code> using:
  </p>
  <pre>
    <code className="lang-bash">
      npm <span className="hljs-keyword">install</span> -g harperdb{"\n"}
    </code>
  </pre>
  <p>
    For more details and troubleshooting while installing,{" "}
    <a href="https://harperdb.io/docs/install-harperdb/">visit the docs</a> .
  </p>
  <p>
    You should be able to run HarperDB now on your local machine by running:
  </p>
  <pre>
    <code className="lang-bash">
      harperdb <span className="hljs-keyword">run</span>
      <span className="bash" />
      {"\n"}
    </code>
  </pre>
  <p>
    The local instance runs on port <code>9925</code> by default.
  </p>
  <h2 id="registering-our-local-instance">Registering our local instance</h2>
  <p>
    Now that our local instance is up and running, we need to register our local
    instance on HarperDB studio. Go ahead and{" "}
    <a href="https://harperdb.io/">sign up</a> for a free account if you haven't
    already.
  </p>
  <p>
    After login, click on{" "}
    <strong>
      Create new HarperDB cloud instance / Register User installed instance
    </strong>
    .
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633043379943/VDz6skdCY.png"
      alt="screenshot-20211001-043641.png"
    />
  </p>
  <p>
    Now click on <strong>Register User-installed instance</strong>:
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633043495567/b8fPN0CQZ.png"
      alt="image.png"
    />
  </p>
  <p>
    Now enter the following details for the local user instance running on
    localhost:9925:
  </p>
  <center>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633043609865/LesnbwqpA.png?width=500"
      alt="screenshot-20211001-044235.png"
    />
    _the default id and password is HDB<em>ADMIN which can be changed later</em>
  </center>
  <p>
    Select the free option for RAM in the next screen and add the instance in
    the next screen after that:
  </p>
  <center>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633043876965/bMXCE9Eki.png?width=500"
      alt="image.png"
    />
  </center>
  <p>Wait for some seconds as the instance is getting registered.</p>
  <h2 id="configuring-the-local-instance">Configuring the local instance</h2>
  <p>
    Once the local instance is registered, on the following screen, you will see
    various tabs. Click on the <strong>browse</strong> tab and add the schema.
    Let's name our schema <code>dev</code>:
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633045050100/f0qIj2xAs.png"
      alt="screenshot-20211001-050713.png"
    />
  </p>
  <p>
    For the discord bot, we will need 2 tables: <code>users</code> and{" "}
    <code>jokes</code>.
  </p>
  <p>
    The <code>users</code> table will hold user information like <code>id</code>{" "}
    (of the user from discord), <code>username</code> (discord username),{" "}
    <code>score</code> (count of number of jokes posted).
  </p>
  <p>
    The <code>jokes</code> table will hold the jokes. It will have columns:{" "}
    <code>id</code> (of the joke), <code>joke</code> (joke text),{" "}
    <code>user_id</code> (id of the user who posted the joke).
  </p>
  <p>For now, let's create those 2 tables by clicking the + button:</p>
  <ol>
    <li>
      <code>users</code> table with hash attr. as <code>id</code>
    </li>
    <li>
      <code>jokes</code> table with hash attr. as <code>id</code>
    </li>
  </ol>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633045174232/Utix0fsG_.png"
      alt="screenshot-20211001-050907.png"
    />
  </p>
  <h2 id="custom-functions">Custom Functions</h2>
  <p>
    Now we come to the most exciting part! Custom Functions! Custom functions
    are powered by Fastify.
  </p>
  <p>
    Click on the <strong>functions</strong> tab and click on{" "}
    <strong>Enable Custom Functions</strong> on the left.
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633045385015/32fyJPBHv.png"
      alt="tmpN9eHCD.png"
    />
  </p>
  <p>
    After you have enabled HarperDB Custom Functions, you will have the option
    to create a <code>project</code>. Let's call ours: <code>discordbot</code>.
  </p>
  <p>
    You can also see where the custom functions project is stored on your local
    machine along with the port on which it runs on (default: <code>9926</code>
    ).
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633463545083/0k4GMHKwG.png"
      alt="tmpHifJqe.png"
    />
  </p>
  <p>
    Fire up the terminal now, and change directory to where the custom functions
    project is present.
  </p>
  <pre>
    <code className="lang-bash">
      cd ~<span className="hljs-regexp">/hdb/</span>custom_
      <span className="hljs-function">
        <span className="hljs-keyword">function</span>
        <span className="hljs-title">s</span>
      </span>
      {"\n"}
    </code>
  </pre>
  <p>
    Now let's clone a function template into a folder <code>discordbot</code>{" "}
    (our custom functions project name) provided by HarperDB to get up and
    running quickly!
  </p>
  <pre>
    <code className="lang-bash">
      git <span className="hljs-keyword">clone</span>{" "}
      <span className="hljs-title">https</span>
      ://github.com/HarperDB/harperdb-custom-functions-template.git discordbot
      {"\n"}
    </code>
  </pre>
  <p>
    Open the folder <code>discordbot</code> in your favourite code editor to see
    what code the template hooked us up with!
  </p>
  <p>
    Once you open up the folder in your code editor, you'll see it is a typical
    npm project.
  </p>
  <p>The routes are defined in routes folder.</p>
  <p>Helper methods are present in helpers folder.</p>
  <p>
    Also, we can have a static website running by using the static folder, but
    we won't be doing that in this tutorial.
  </p>
  <p>We can also install npm packages and use them in our code.</p>
  <h2 id="discord-bot-setup">Discord Bot Setup</h2>
  <p>
    Before we write some code, let us set up our discord developer account and
    create our bot and invite it into a Discord server.
  </p>
  <p>
    Before all this, I recommend you to create a discord server for testing this
    bot, which is{" "}
    <a href="https://blog.discord.com/starting-your-first-discord-server-4dcacda8dad5">
      pretty straight-forward
    </a>{" "}
    . Or you can use an existing Discord server too.
  </p>
  <p>Now, let's create our bot.</p>
  <p>
    Go to{" "}
    <a href="https://discord.com/developers/applications">
      Discord Developer Portal
    </a>{" "}
    and click "New Application" on the top right. Give it any name and click
    "Create".
  </p>
  <p>
    Next click the "Bot" button on the left sidebar and click "Add Bot". Click
    "Yes, do it!" when prompted.
  </p>
  <p>
    Now, we have created our bot successfully. Later we are going to need some
    information which will allow us to access our bot. Please follow the
    following instructions to find everything we will need:
  </p>
  <p>
    <strong>Application ID:</strong> Go to the "General Information" tab on the
    left. Copy the value called "Application ID".
  </p>
  <p>
    <strong>Public Key:</strong> On the "General Information" tab, copy the
    value in the field called "Public Key".
  </p>
  <p>
    <strong>Bot Token:</strong> On the "Bot" tab in the left sidebar, copy the
    "Token" value.
  </p>
  <p>Keep these values safe for later.</p>
  <h3 id="inviting-our-bot-to-our-server">Inviting our bot to our server</h3>
  <p>
    The bot is created but we still need to invite it into our server. Let's do
    that now.
  </p>
  <p>
    Copy the following URL and replace{" "}
    <your_application_id>
      {" "}
      with your application ID that you copied from Discord Developer Portal:
    </your_application_id>
  </p>
  <p>
    <code>
      https://discord.com/api/oauth2/authorize?client_id=&lt;YOUR_APPLICATION_ID&gt;&amp;permissions=8&amp;scope=applications.commands%20bot
    </code>
  </p>
  <p>
    <em>
      Here we are giving the bot commands permission and bot admin permissions
    </em>
  </p>
  <p>Open that constructed URL in a new tab, and you will see the following:</p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633462819511/BWq5Xy4Jo.png"
      alt="tmp_NMGRH.png"
    />
  </p>
  <p>
    Select your server and click on <strong>Continue</strong> and then{" "}
    <strong>Authorize</strong> in the next screen. Now you should see your bot
    in your Discord server.
  </p>
  <p>Now, let's finally get to some code, shall we?</p>
  <h2 id="get-set-code-">Get. Set. Code.</h2>
  <p>
    Switch to your editor where you have opened the <code>discordbot</code>{" "}
    folder in the previous steps.
  </p>
  <p>First, let's install the dependencies we will need:</p>
  <ol>
    <li>
      <code>npm i discord-interactions</code>: discord-interactions contains
      handy discord methods to make the creation of our bot simple.
    </li>
    <li>
      <code>npm i nanoid</code>: nanoid is a small uuid generator which we will
      use to generate unique ids for our jokes.
    </li>
    <li>
      <code>npm i fastify-raw-body</code>: For verifying our bot later using
      discord-interactions, we need access to the raw request body. As Fastify
      doesn't support this by default, we will use fastify-raw-body.
    </li>
  </ol>
  <p>
    Open the <strong>examples.js</strong> file and delete all the routes
    present. We will add our routes one by one. Your file should look like
    below:
  </p>
  <pre>
    <code className="lang-js">
      <span className="hljs-meta">"use strict"</span>;{"\n"}
      {"\n"}
      <span className="hljs-comment">
        // eslint-disable-next-line no-unused-vars,require-await
      </span>
      {"\n"}
      <span className="hljs-built_in">module</span>.exports ={" "}
      <span className="hljs-keyword">async</span> (server, {"{"} hdbCore, logger{" "}
      {"}"}) =&gt; {"{"}
      {"}"};{"\n"}
    </code>
  </pre>
  <p>
    Now, we will add our routes inside the file. All routes created inside this
    file, will be relative to <code>/discordbot</code>.
  </p>
  <p>
    For example, let's now create a GET route at <code>/</code> which will open
    at <code>localhost:9926/discordbot</code>
  </p>
  <pre>
    <code className="lang-js">
      {"    "}server.route({"{"}
      {"\n"}
      {"    "}url: <span className="hljs-string">"/"</span>,{"\n"}
      {"    "}method: <span className="hljs-string">
        "<span className="hljs-keyword">GET</span>"
      </span>,{"\n"}
      {"    "}handler: (request) =&gt; {"{"}
      {"\n"}
      {"      "}return {"{"} status:{" "}
      <span className="hljs-string">"Server running!"</span> {"}"};{"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}
      {"}"});{"\n"}
      {"}"};{"\n"}. . .{"\n"}
    </code>
  </pre>
  <p>
    Now save the file and go to HarperDB studio and click on "restart server" on
    the "functions" tab:
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633127537044/SV4z5KKH-.png"
      alt="image.png"
    />
  </p>
  <p>
    Anytime you make any change to the code, make sure to restart the custom
    functions server.
  </p>
  <p>
    By the way, did you see that your code was reflected in the studio on the
    editor? Cool, right?
  </p>
  <p>
    Now to see the results of your added route, visit{" "}
    <code>localhost:9926/discordbot</code> on your browser, and you should get a
    JSON response of:
  </p>
  <pre>
    <code className="lang-JSON">
      {"{"}
      {"\n"}
      {"  "}
      <span className="hljs-attr">"status"</span>: <span className="hljs-string">
        "Server running!"
      </span>
      {"\n"}
      {"}"}
      {"\n"}
    </code>
  </pre>
  <p>Yay! Our code works!</p>
  <p>
    Now for the most exciting part, let's start coding the discord bot. We will
    import <code>InteractionResponseType</code>, <code>InteractionType</code>{" "}
    and <code>verifyKey</code> from <code>discord-interactions</code>.
  </p>
  <pre>
    <code className="lang-js">
      <span className="hljs-keyword">const</span> {"{"}
      {"\n"}
      {"  "}InteractionResponseType,{"\n"}
      {"  "}InteractionType,{"\n"}
      {"  "}verifyKey,{"\n"}
      {"}"} = <span className="hljs-built_in">require</span>(<span className="hljs-string">
        "discord-interactions"
      </span>);{"\n"}
    </code>
  </pre>
  <p>
    We will create a simple POST request at <code>/</code> which will basically
    respond to a <code>PING</code> interaction with a <code>PONG</code>{" "}
    interaction.
  </p>
  <pre>
    <code className="lang-js">
      . . .{"\n"}server.route({"{"}
      {"\n"}
      {"    "}url: <span className="hljs-string">"/"</span>,{"\n"}
      {"    "}method: <span className="hljs-string">
        "<span className="hljs-keyword">POST</span>"
      </span>,{"\n"}
      {"    "}handler: async (request) =&gt; {"{"}
      {"\n"}
      {"      "}const myBody = request.body;{"\n"}
      {"      "}if (myBody.type === InteractionType.PING) {"{"}
      {"\n"}
      {"        "}return {"{"} type: InteractionResponseType.PONG {"}"};{"\n"}
      {"      "}
      {"}"}
      {"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}
      {"}"});{"\n"}. . .{"\n"}
    </code>
  </pre>
  <p>
    Now let's go to the Discord Portal and register our POST endpoint as the{" "}
    <strong>Interactions Endpoint URL</strong>. Go to your application in
    Discord Developer Portal and click on the "General Information" tab, and
    paste our endpoint in the <strong>Interactions Endpoint URL</strong> field.
    But oops! Our app is currently running on localhost which Discord cannot
    reach. So for a temporary solution, we will use a tunnelling service called{" "}
    <strong>ngrok</strong>.
    <em>
      After we finish coding and testing our code, we will deploy the bot to
      HarperDB cloud instance with a single click for free.
    </em>
  </p>
  <p>For Mac, to install ngrok:</p>
  <pre>
    <code>
      <span className="hljs-keyword">brew </span>
      <span className="hljs-keyword">install </span>ngrok <span className="hljs-comment">
        # assuming you have homebrew installed
      </span>
      {"\n"}ngrok http <span className="hljs-number">9926</span>{" "}
      <span className="hljs-comment"># create a tunnel to localhost:9926</span>
      {"\n"}
    </code>
  </pre>
  <p>
    For other operating systems, follow the{" "}
    <a href="https://ngrok.com/download">installation instructions</a> .
  </p>
  <p>
    Copy the <code>https</code> URL you get from ngrok.
  </p>
  <p>
    Paste the following to the <strong>Interactions Endpoint URL</strong> field:
    <code>YOUR_NGROK_URL/discordbot</code>.
  </p>
  <p>Now, click on "Save changes". But we get an error:</p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633129322177/30GFMNbhV.png"
      alt="screenshot-20211002-043140.png"
    />
  </p>
  <p>
    So, actually discord won't accept ANY request which is sent to it, we need
    to perform verification to check for the validity of the request. Let's
    perform that verification. For that, we need access to the raw request body
    and for that we will use <code>fastify-raw-body</code>.
  </p>
  <p>
    Add the following code just before the GET <code>/</code> route.
  </p>
  <pre>
    <code className="lang-js">
      . . .{"\n"}
      {"\n"}server.register(require(<span className="hljs-string">
        "fastify-raw-body"
      </span>), {"{"}
      {"\n"}
      {"    "}field: <span className="hljs-string">"rawBody"</span>,{"\n"}
      {"    "}
      <span className="hljs-keyword">global</span>: <span className="hljs-literal">
        false
      </span>,{"\n"}
      {"    "}encoding: <span className="hljs-string">"utf8"</span>,{"\n"}
      {"    "}runFirst: <span className="hljs-literal">true</span>,{"\n"}
      {"  "}
      {"}"})<span className="hljs-comment">;</span>
      {"\n"}
      {"\n"}
      {"  "}server.addHook(<span className="hljs-string">"preHandler"</span>,
      async (request, response) =&gt; {"{"}
      {"\n"}
      {"    "}
      <span className="hljs-keyword">if</span> (request.method === <span className="hljs-string">
        "POST"
      </span>) {"{"}
      {"\n"}
      {"      "}
      <span className="hljs-keyword">const</span> signature = request.headers[
      <span className="hljs-string">"x-signature-ed25519"</span>]<span className="hljs-comment">
        ;
      </span>
      {"\n"}
      {"      "}
      <span className="hljs-keyword">const</span> timestamp = request.headers[
      <span className="hljs-string">"x-signature-timestamp"</span>]
      <span className="hljs-comment">;</span>
      {"\n"}
      {"      "}
      <span className="hljs-keyword">const</span> isValidRequest = verifyKey(
      {"\n"}
      {"        "}request.rawBody,{"\n"}
      {"        "}signature,{"\n"}
      {"        "}timestamp,{"\n"}
      {"        "}&lt;YOUR_PUBLIC_KEY&gt; // as a{" "}
      <span className="hljs-built_in">string</span>, e.g. :{" "}
      <span className="hljs-string">"7171664534475faa2bccec6d8b1337650f7"</span>
      {"\n"}
      {"      "})<span className="hljs-comment">;</span>
      {"\n"}
      {"      "}
      <span className="hljs-keyword">if</span> (!isValidRequest) {"{"}
      {"\n"}
      {"        "}server.<span className="hljs-built_in">log</span>.info(<span className="hljs-string">
        "Invalid Request"
      </span>)<span className="hljs-comment">;</span>
      {"\n"}
      {"        "}
      <span className="hljs-keyword">return</span> response.status(
      <span className="hljs-number">401</span>).
      <span className="hljs-built_in">send</span>({"{"} error:{" "}
      <span className="hljs-string">"Bad request signature "</span> {"}"})
      <span className="hljs-comment">;</span>
      {"\n"}
      {"      "}
      {"}"}
      {"\n"}
      {"    "}
      {"}"}
      {"\n"}
      {"  "}
      {"}"})<span className="hljs-comment">;</span>
      {"\n"}. . .{"\n"}
    </code>
  </pre>
  <p>
    Also, we will need to add <code>rawBody:true</code> to the config of our
    POST <code>/</code> route. So, now it will look like this:
  </p>
  <pre>
    <code className="lang-js">
      . . .{"\n"}server.route({"{"}
      {"\n"}
      {"    "}url: <span className="hljs-string">"/"</span>,{"\n"}
      {"    "}method: <span className="hljs-string">
        "<span className="hljs-keyword">POST</span>"
      </span>,{"\n"}
      {"    "}config: {"{"}
      {"\n"}
      {"      "}// add the rawBody to this route{"\n"}
      {"      "}rawBody: true,{"\n"}
      {"    "}
      {"}"},{"\n"}
      {"    "}handler: async (request) =&gt; {"{"}
      {"\n"}
      {"      "}const myBody = request.body;{"\n"}
      {"\n"}
      {"      "}if (myBody.type === InteractionType.PING) {"{"}
      {"\n"}
      {"        "}return {"{"} type: InteractionResponseType.PONG {"}"};{"\n"}
      {"      "}
      {"}"}
      {"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}
      {"}"});{"\n"}. . .{"\n"}
    </code>
  </pre>
  <p>(Don't forget to restart the functions server after each code change)</p>
  <p>
    Now try to put <code>YOUR_NGROK_URL/discordbot</code> in the{" "}
    <strong>Interactions Endpoint URL</strong> field. And voila! We will be
    greeted with a success message.
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633130069473/Am0lThLvJ.png"
      alt="screenshot-20211002-044242.png"
    />
  </p>
  <p>
    So, now our endpoint is registered and verified. Now let's add the commands
    for our bot in the code. We will have 3 slash commands.
  </p>
  <ol>
    <li>
      <strong>/sayjoke joke</strong> : post a joke on the discord server.
    </li>
    <li>
      <strong>/listjokes username</strong>: view jokes of a particular user.
    </li>
    <li>
      <strong>/top</strong>: check the leader with the max. number of jokes
      posted.
    </li>
  </ol>
  <p>
    Let's first create a <code>commands.js</code> file inside the{" "}
    <code>helpers</code> folder and write the following code for the commands.
    We will be using this in the routes.
  </p>
  <pre>
    <code className="lang-js">
      const SAY_JOKE = {"{"}
      {"\n"}
      <span className="hljs-symbol">{"  "}name:</span>{" "}
      <span className="hljs-string">"sayjoke"</span>,{"\n"}
      <span className="hljs-symbol">{"  "}description:</span> <span className="hljs-string">
        "Say a programming joke and make everyone go ROFL!"
      </span>,{"\n"}
      <span className="hljs-symbol">{"  "}options:</span> [{"\n"}
      {"    "}
      {"{"}
      {"\n"}
      <span className="hljs-symbol">{"      "}type:</span>{" "}
      <span className="hljs-number">3</span>,{" "}
      <span className="hljs-comment">// a string is type 3</span>
      {"\n"}
      <span className="hljs-symbol">{"      "}name:</span>{" "}
      <span className="hljs-string">"joke"</span>,{"\n"}
      <span className="hljs-symbol">{"      "}description:</span> <span className="hljs-string">
        "The programming joke."
      </span>,{"\n"}
      <span className="hljs-symbol">{"      "}required:</span> true,{"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}],{"\n"}
      {"}"};{"\n"}
      {"\n"}const TOP = {"{"}
      {"\n"}
      <span className="hljs-symbol">{"  "}name:</span> <span className="hljs-string">
        "top"
      </span>,{"\n"}
      <span className="hljs-symbol">{"  "}description:</span>{" "}
      <span className="hljs-string">
        "Find out who is the top scorer with his score."
      </span>
      ,{"\n"}
      {"}"};{"\n"}
      {"\n"}const LIST_JOKES = {"{"}
      {"\n"}
      <span className="hljs-symbol">{"  "}name:</span> <span className="hljs-string">
        "listjokes"
      </span>,{"\n"}
      <span className="hljs-symbol">{"  "}description:</span>{" "}
      <span className="hljs-string">
        "Display programming jokes said by a user."
      </span>
      ,{"\n"}
      <span className="hljs-symbol">{"  "}options:</span> [{"\n"}
      {"    "}
      {"{"}
      {"\n"}
      <span className="hljs-symbol">{"      "}name:</span> <span className="hljs-string">
        "user"
      </span>,{"\n"}
      <span className="hljs-symbol">{"      "}description:</span>{" "}
      <span className="hljs-string">
        "The user whose jokes you want to hear."
      </span>
      ,{"\n"}
      <span className="hljs-symbol">{"      "}type:</span> <span className="hljs-number">
        6
      </span>, <span className="hljs-comment">// a user mention is type 6</span>
      {"\n"}
      <span className="hljs-symbol">{"      "}required:</span> true,{"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}],{"\n"}
      {"}"};{"\n"}
      {"\n"}module.exports = {"{"}
      {"\n"}
      {"  "}SAY_JOKE,{"\n"}
      {"  "}TOP,{"\n"}
      {"  "}LIST_JOKES,{"\n"}
      {"}"};{"\n"}
    </code>
  </pre>
  <h2 id="registering-the-slash-commands">Registering the slash commands</h2>
  <p>
    Before using these in the routes file, we will need to register them first.
    This is a one-time process for each command.
  </p>
  <p>Open Postman or any other REST API client.</p>
  <p>Make a New Request with type: POST.</p>
  <p>
    URL should be:
    <a href="https://discord.com/api/v8/applications/YOUR_APPLICATION_ID/commands">
      https://discord.com/api/v8/applications/YOUR_APPLICATION_ID/commands
    </a>
  </p>
  <p>On the Headers tab, add 2 headers:</p>
  <pre>
    <code>
      Content-Type:application/json{"\n"}
      <span className="hljs-symbol">Authorization:</span>Bot <span className="hljs-params">
        &lt;YOUR_BOT_TOKEN&gt;
      </span>
      {"\n"}
    </code>
  </pre>
  <p>Now for each command, change the Body and Hit Send. For sayjoke:</p>
  <pre>
    <code className="lang-JSON">
      {"{"}
      {"\n"}
      {"    "}
      <span className="hljs-attr">"name"</span>: <span className="hljs-string">
        "sayjoke"
      </span>,{"\n"}
      {"    "}
      <span className="hljs-attr">"description"</span>: <span className="hljs-string">
        "Say a programming joke and make everyone go ROFL!"
      </span>,{"\n"}
      {"    "}
      <span className="hljs-attr">"options"</span>: [{"\n"}
      {"        "}
      {"{"}
      {"\n"}
      {"            "}
      <span className="hljs-attr">"type"</span>:{" "}
      <span className="hljs-number">3</span>,{"\n"}
      {"            "}
      <span className="hljs-attr">"name"</span>:{" "}
      <span className="hljs-string">"joke"</span>,{"\n"}
      {"            "}
      <span className="hljs-attr">"description"</span>:{" "}
      <span className="hljs-string">"The programming joke."</span>,{"\n"}
      {"            "}
      <span className="hljs-attr">"required"</span>:{" "}
      <span className="hljs-literal">true</span>
      {"\n"}
      {"        "}
      {"}"}
      {"\n"}
      {"    "}]{"\n"}
      {"}"}
      {"\n"}
    </code>
  </pre>
  <p>You should see a response similar to this:</p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633131036553/hEgmClgda.png"
      alt="screenshot-20211002-050015.png"
    />
  </p>
  <p>Similarly, let's register the other 2 commands.</p>
  <p>For listjokes:</p>
  <pre>
    <code className="lang-JSON">
      {"{"}
      {"\n"}
      {"    "}
      <span className="hljs-attr">"name"</span>: <span className="hljs-string">
        "listjokes"
      </span>,{"\n"}
      {"    "}
      <span className="hljs-attr">"description"</span>: <span className="hljs-string">
        "Display all programming jokes said by a user."
      </span>,{"\n"}
      {"    "}
      <span className="hljs-attr">"options"</span>: [{"\n"}
      {"        "}
      {"{"}
      {"\n"}
      {"            "}
      <span className="hljs-attr">"name"</span>:{" "}
      <span className="hljs-string">"user"</span>,{"\n"}
      {"            "}
      <span className="hljs-attr">"description"</span>:{" "}
      <span className="hljs-string">
        "The user whose jokes you want to hear."
      </span>
      ,{"\n"}
      {"            "}
      <span className="hljs-attr">"type"</span>: <span className="hljs-number">
        6
      </span>,{"\n"}
      {"            "}
      <span className="hljs-attr">"required"</span>: <span className="hljs-literal">
        true
      </span>
      {"\n"}
      {"        "}
      {"}"}
      {"\n"}
      {"    "}]{"\n"}
      {"}"}
      {"\n"}
    </code>
  </pre>
  <p>For top:</p>
  <pre>
    <code className="lang-JSON">
      {"{"}
      {"\n"}
      {"    "}
      <span className="hljs-attr">"name"</span>: <span className="hljs-string">
        "top"
      </span>,{"\n"}
      {"    "}
      <span className="hljs-attr">"description"</span>: <span className="hljs-string">
        "Find out who is the top scorer with his score."
      </span>
      {"\n"}
      {"}"}
      {"\n"}
    </code>
  </pre>
  <p>
    <strong>NOTE</strong>: Now we have to wait 1 hour till all the commands are
    registered. If you don't want to wait, you can use your{" "}
    <a href="https://github-wiki-see.page/m/manix84/discord_gmod_addon_v2/wiki/Finding-your-Guild-ID-%28Server-ID%29">
      Guild/server ID
    </a>{" "}
    . But in this case, your bot will work in that server/guild.
  </p>
  <p>
    Just replace the URL with:
    <code>
      https://discord.com/api/v8/applications/892533254752718898/guilds/&lt;YOUR_GUILD_ID&gt;/commands
    </code>
  </p>
  <p>
    Once your commands are registered, you should be able to see those commands
    popup when you type / on the chat.
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633131669358/GkLrVFIYk.png"
      alt="screenshot-20211002-051012.png"
    />
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633131656109/vI9gLEhJs.png"
      alt="screenshot-20211002-050942.png"
    />
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633131682294/DllfajO2J.png"
      alt="screenshot-20211002-051035.png"
    />
  </p>
  <p>
    But when you select any of these, you'll get an error. This is expected as
    we haven't written the code for these slash commands.
  </p>
  <h2 id="writing-code-for-the-slash-commands">
    Writing code for the slash commands
  </h2>
  <p>
    Hop over to the <code>routes/examples.js</code> file and let's write some
    more code.
  </p>
  <p>
    We will add a condition to the <code>/</code> POST route to check if it is a
    slash command:
  </p>
  <pre>
    <code className="lang-js">
      . . .{"\n"}server.route({"{"}
      {"\n"}
      {"    "}url: <span className="hljs-string">"/"</span>,{"\n"}
      {"    "}method: <span className="hljs-string">"POST"</span>,{"\n"}
      {"    "}config: {"{"}
      {"\n"}
      {"      "}
      <span className="hljs-comment">// add the rawBody to this route</span>
      {"\n"}
      {"      "}rawBody: <span className="hljs-keyword">true</span>,{"\n"}
      {"    "}
      {"}"},{"\n"}
      {"    "}handler: async (request) =&gt; {"{"}
      {"\n"}
      {"      "}const myBody = request.body;{"\n"}
      {"\n"}
      {"      "}
      <span className="hljs-keyword">if</span> (myBody.<span className="hljs-keyword">
        type
      </span> === InteractionType.PING) {"{"}
      {"\n"}
      {"        "}
      <span className="hljs-keyword">return</span> {"{"}{" "}
      <span className="hljs-class">
        <span className="hljs-keyword">type</span>:{" "}
        <span className="hljs-title">InteractionResponseType</span>.
        <span className="hljs-title">PONG</span> {"}"};
      </span>
      {"\n"}
      {"      "}
      {"}"} <span className="hljs-keyword">else</span> <span className="hljs-keyword">
        if
      </span> (myBody.<span className="hljs-keyword">type</span> === InteractionType.APPLICATION_COMMAND){" "}
      {"{"}
      {"\n"}
      {"          "}
      <span className="hljs-comment">// to handle slash commands here</span>
      {"\n"}
      {"      "}
      {"}"}
      {"\n"}
      {"    "}
      {"}"},{"\n"}
      {"  "}
      {"}"});{"\n"}. . .{"\n"}
    </code>
  </pre>
  <p>
    So inside the <code>else if</code> block, we are checking if the type is{" "}
    <code>InteractionType.APPLICATION_COMMAND</code> i.e. our slash commands.
    Inside this block, we will add the logic for handling our 3 slash commands.
  </p>
  <p>
    Let's import the commands information from <code>commands.js</code> in{" "}
    <code>examples.js</code> file.
  </p>
  <p>At the top of the file, add the following lines:</p>
  <pre>
    <code className="lang-js">
      <span className="hljs-keyword">const</span> {"{"} SAY_JOKE, TOP,
      LIST_JOKES {"}"} = <span className="hljs-built_in">require</span>(
      <span className="hljs-string">"../helpers/commands"</span>);{"\n"}
    </code>
  </pre>
  <h3 id="the-sayjoke-command-">The /sayjoke command:</h3>
  <p>
    The <code>/sayjoke</code> command allows a user to post a programming joke
    to the Discord channel. First, Let's add the code for <code>/sayjoke</code>{" "}
    command.
  </p>
  <pre>
    <code className="lang-js">
      <span className="hljs-comment">
        // replace the existing line with below line
      </span>
      {"\n"}
      <span className="hljs-keyword">else</span>{" "}
      <span className="hljs-keyword">if</span> (myBody.type ===
      InteractionType.APPLICATION_COMMAND) {"{"}
      {"\n"}
      {"        "}
      <span className="hljs-keyword">const</span> user = myBody.member.user; <span className="hljs-comment">
        // discord user object
      </span>
      {"\n"}
      {"        "}
      <span className="hljs-keyword">const</span> username ={" "}
      <span className="hljs-string">
        `
        <span className="hljs-subst">
          ${"{"}user.username{"}"}
        </span>
        `
      </span>
      ; <span className="hljs-comment">// discord username</span>
      {"\n"}
      {"\n"}
      {"        "}
      <span className="hljs-keyword">const</span> id = user.id; <span className="hljs-comment">
        //discord userid (e.g. 393890098061771919)
      </span>
      {"\n"}
      {"        "}
      <span className="hljs-keyword">switch</span>{" "}
      (myBody.data.name.toLowerCase()) {"{"}
      {"\n"}
      {"          "}
      <span className="hljs-keyword">case</span> SAY_JOKE.name.toLowerCase():
      {"\n"}
      {"            "}request.body = {"{"}
      {"\n"}
      {"              "}
      <span className="hljs-attr">operation</span>:{" "}
      <span className="hljs-string">"sql"</span>,{"\n"}
      {"              "}
      <span className="hljs-attr">sql</span>:{" "}
      <span className="hljs-string">
        `SELECT * FROM dev.users WHERE id ={" "}
        <span className="hljs-subst">
          ${"{"}id{"}"}
        </span>
        `
      </span>
      ,{"\n"}
      {"            "}
      {"}"};{"\n"}
      {"            "}
      <span className="hljs-keyword">const</span> sayJokeResponse = <span className="hljs-keyword">
        await
      </span> hdbCore.requestWithoutAuthentication(request);{"\n"}
      {"            "}
      <span className="hljs-keyword">if</span> (sayJokeResponse.length === <span className="hljs-number">
        0
      </span>) {"{"}
      {"\n"}
      {"              "}
      <span className="hljs-comment">
        // new user, so insert a new row to users table
      </span>
      {"\n"}
      {"              "}request.body = {"{"}
      {"\n"}
      {"                "}
      <span className="hljs-attr">operation</span>: <span className="hljs-string">
        "sql"
      </span>,{"\n"}
      {"                "}
      <span className="hljs-attr">sql</span>: <span className="hljs-string">
        `INSERT INTO dev.users (id, name, score) VALUES ('
        <span className="hljs-subst">
          ${"{"}id{"}"}
        </span>
        ', '
        <span className="hljs-subst">
          ${"{"}username{"}"}
        </span>
        ', '1')`
      </span>,{"\n"}
      {"              "}
      {"}"};{"\n"}
      {"              "}
      <span className="hljs-keyword">await</span>{" "}
      hdbCore.requestWithoutAuthentication(request);{"\n"}
      {"            "}
      {"}"} <span className="hljs-keyword">else</span> {"{"}
      {"\n"}
      {"              "}
      <span className="hljs-comment">
        // old user, so update the users table by updating the user's score
      </span>
      {"\n"}
      {"              "}request.body = {"{"}
      {"\n"}
      {"                "}
      <span className="hljs-attr">operation</span>:{" "}
      <span className="hljs-string">"sql"</span>,{"\n"}
      {"                "}
      <span className="hljs-attr">sql</span>:{" "}
      <span className="hljs-string">
        `UPDATE dev.users SET score ={" "}
        <span className="hljs-subst">
          ${"{"}
          {"\n"}
          {"                  "}sayJokeResponse[
          <span className="hljs-number">0</span>].score + <span className="hljs-number">
            1
          </span>
          {"\n"}
          {"                "}
          {"}"}
        </span>
        {"  "}WHERE id = <span className="hljs-subst">
          ${"{"}id{"}"}
        </span>`
      </span>
      ,{"\n"}
      {"              "}
      {"}"};{"\n"}
      {"              "}
      <span className="hljs-keyword">await</span> hdbCore.requestWithoutAuthentication(request);
      {"\n"}
      {"            "}
      {"}"}
      {"\n"}
      {"            "}
      <span className="hljs-keyword">const</span> jokeId = nanoid();{" "}
      <span className="hljs-comment">// creating a new id for joke</span>
      {"\n"}
      {"            "}
      <span className="hljs-keyword">const</span> joke = myBody.data.options[
      <span className="hljs-number">0</span>].value;{"\n"}
      {"              "}
      <span className="hljs-comment">
        // insert the joke into the jokes table
      </span>
      {"\n"}
      {"            "}request.body = {"{"}
      {"\n"}
      {"              "}
      <span className="hljs-attr">operation</span>: <span className="hljs-string">
        "sql"
      </span>,{"\n"}
      {"              "}
      <span className="hljs-attr">sql</span>: <span className="hljs-string">
        `INSERT INTO dev.jokes (id, joke, person_id) VALUE ('
        <span className="hljs-subst">
          ${"{"}jokeId{"}"}
        </span>
        ', '
        <span className="hljs-subst">
          ${"{"}joke{"}"}
        </span>
        ', '<span className="hljs-subst">
          ${"{"}id{"}"}
        </span>
        ')`
      </span>,{"\n"}
      {"            "}
      {"}"};{"\n"}
      {"            "}
      <span className="hljs-keyword">await</span> hdbCore.requestWithoutAuthentication(request);
      {"\n"}
      {"            "}
      <span className="hljs-keyword">const</span> newScore =
      sayJokeResponse.length === <span className="hljs-number">0</span> ?{" "}
      <span className="hljs-number">1</span> : sayJokeResponse[
      <span className="hljs-number">0</span>].score +{" "}
      <span className="hljs-number">1</span>;{"\n"}
      {"\n"}
      {"            "}
      <span className="hljs-keyword">return</span> {"{"}
      {"\n"}
      {"              "}
      <span className="hljs-attr">type</span>:
      InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
      {"\n"}
      {"              "}
      <span className="hljs-attr">data</span>: {"{"}
      {"\n"}
      {"                "}
      <span className="hljs-attr">content</span>:{" "}
      <span className="hljs-string">
        `&lt;@
        <span className="hljs-subst">
          ${"{"}id{"}"}
        </span>
        &gt; says:\n*
        <span className="hljs-subst">
          ${"{"}joke{"}"}
        </span>* \n&lt;@
        <span className="hljs-subst">
          ${"{"}id{"}"}
        </span>
        &gt;'s score is now: **
        <span className="hljs-subst">
          ${"{"}newScore{"}"}
        </span>
        **`
      </span>
      , <span className="hljs-comment">// in markdown format</span>
      {"\n"}
      {"                "}embeds: [{"\n"}
      {"            "}
      <span className="hljs-comment">
        // we have an embedded image in the response
      </span>
      {"\n"}
      {"                  "}
      {"{"}
      {"\n"}
      {"                    "}
      <span className="hljs-attr">type</span>: <span className="hljs-string">
        "rich"
      </span>,{"\n"}
      {"                    "}
      <span className="hljs-attr">image</span>: {"{"}
      {"\n"}
      {"                      "}
      <span className="hljs-attr">url</span>:{" "}
      <span className="hljs-string">
        "https://res.cloudinary.com/geekysrm/image/upload/v1632951540/rofl.gif"
      </span>
      ,{"\n"}
      {"                    "}
      {"}"},{"\n"}
      {"                  "}
      {"}"},{"\n"}
      {"                "}],{"\n"}
      {"              "}
      {"}"},{"\n"}
      {"            "}
      {"}"};{"\n"}
    </code>
  </pre>
  <p>
    Woah! That's a lot of code. Let's understand the code we just wrote step by
    step.
  </p>
  <p>
    First of all, we get the user object from Discord containing all the details
    of the user who called this command. From that object, we extract the
    username and id of the discord user.
  </p>
  <p>
    Now, inside the <code>switch</code> case, we compare the name of the command
    to our 3 slash command names. Here, we are handling the{" "}
    <code>/sayjoke</code> command.
  </p>
  <p>
    We do a <code>SELECT</code> SQL query to HarperDB's database, to get the
    details of the user with the id as the userid we just extracted. There are 2
    cases:
  </p>
  <ol>
    <li>
      <p>
        New user: It might happen that we get <code>[ ]</code> from the{" "}
        <code>SELECT</code> query, which means we don't find the user in the
        users table. That means, he has posted a joke for the first time and we
        need to insert this user to our users table. So, we use the{" "}
        <code>INSERT</code> SQL query to insert his id, name and score (as 1).
      </p>
    </li>
    <li>
      <p>
        Old user: The user might be an old user i.e. already posted a joke
        earlier too. So, we have that user in our users table. So we just update
        his row by increasing his score by 1. We use the <code>UPDATE</code>{" "}
        query to perform this operation.
      </p>
    </li>
  </ol>
  <p>
    Next, we need to insert the joke into the jokes table. We get the joke text
    from <code>options[0].value</code> as joke is a required parameter for{" "}
    <code>/sayjoke</code>. We use the <code>INSERT</code> query and insert the
    joke along with a unique jokeId and the id of the person who posted the
    joke.
  </p>
  <p>
    Phew! That was a lot of Database code. Then, we simply need to respond to
    the user with some response. Discord response supports{" "}
    <a href="https://www.markdownguide.org/cheat-sheet/">Markdown</a> so we are
    going to use that. Along with that we will also embed a{" "}
    <a href="https://res.cloudinary.com/geekysrm/image/upload/v1632951540/rofl.gif">
      LOL gif
    </a>
    .
  </p>
  <h3 id="the-top-command-">The /top command:</h3>
  <p>
    The top command would show the user with the highest number of jokes posted
    along with his score. Here goes the code:
  </p>
  <pre>
    <code className="lang-js">
      case TOP.name.toLowerCase():{"\n"}
      {"    "}request.body = {"{"}
      {"\n"}
      {"        "}operation: <span className="hljs-string">"sql"</span>,{"\n"}
      {"        "}sql: `SELECT * FROM dev.users{" "}
      <span className="hljs-keyword">ORDER</span>{" "}
      <span className="hljs-keyword">BY</span>{" "}
      <span className="hljs-keyword">score</span>{" "}
      <span className="hljs-keyword">DESC</span> LIMIT 1`,{"\n"}
      {"    "}
      {"}"};{"\n"}
      {"\n"}
      {"    "}
      <span className="hljs-keyword">const</span> topResponse = await hdbCore.requestWithoutAuthentication(request);
      {"\n"}
      {"    "}
      <span className="hljs-keyword">const</span> top = topResponse[0];{"\n"}
      {"    "}
      <span className="hljs-keyword">return</span> {"{"}
      {"\n"}
      {"        "}
      <span className="hljs-keyword">type</span>: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
      {"\n"}
      {"        "}data: {"{"}
      {"\n"}
      {"        "}content: `**@<span className="hljs-variable">${"{"}top</span>
      .name
      {"}"}** is topping the <span className="hljs-keyword">list</span> with <span className="hljs-keyword">
        score
      </span> **<span className="hljs-variable">${"{"}top</span>.<span className="hljs-keyword">
        score
      </span>
      {"}"}**. \nSee his programming jokes with */listjoke{" "}
      <span className="hljs-variable">${"{"}top</span>.name{"}"}*`,{"\n"}
      {"        "}
      {"}"},{"\n"}
      {"}"};{"\n"}
    </code>
  </pre>
  <p>
    This one is pretty straight-forward. When anyone invokes the{" "}
    <code>/top</code> command, we simply do a <code>SELECT</code> query to fetch
    the user with the top score.
  </p>
  <p>Then, we respond with some markdown content as shown in the code above.</p>
  <h3 id="the-listjokes-command-">The /listjokes command:</h3>
  <p>
    The <code>/listjokes</code> command takes a required option i.e. the user.
    So, one can do <code>/listjokes @geekysrm</code> to get all jokes posted by
    user <code>geekysrm</code>.
  </p>
  <p>Let's write the code for the same:</p>
  <pre>
    <code className="lang-js">
      case LIST_JOKES.name.toLowerCase():{"\n"}
      {"    "}const selectedUser = myBody<span className="hljs-meta">
        .data
      </span>.options[<span className="hljs-number">0</span>].value.toString()<span className="hljs-comment">
        ;
      </span>
      {"\n"}
      {"    "}request.<span className="hljs-keyword">body </span>= {"{"}
      {"\n"}
      <span className="hljs-symbol">{"        "}operation:</span> <span className="hljs-string">
        "sql"
      </span>,{"\n"}
      <span className="hljs-symbol">{"        "}sql:</span> `SELECT{" "}
      <span className="hljs-keyword">joke </span>FROM dev.
      <span className="hljs-keyword">jokes </span>WHERE person_id = ${"{"}
      selectedUser{"}"} LIMIT <span className="hljs-number">5</span>`,{"\n"}
      {"    "}
      {"}"}
      <span className="hljs-comment">;</span>
      {"\n"}
      {"\n"}
      {"    "}const <span className="hljs-keyword">jokes </span>= await
      hdbCore.requestWithoutAuthentication(request)
      <span className="hljs-comment">;</span>
      {"\n"}
      {"    "}let contentString ={"\n"}
      {"        "}
      <span className="hljs-keyword">jokes.length </span>=== <span className="hljs-number">
        0
      </span>
      {"\n"}
      {"        "}? <span className="hljs-string">
        "User has not posted any jokes ðŸ˜•"
      </span>
      {"\n"}
      {"        "}: <span className="hljs-string">
        "Here are the jokes posted by that user:\n"
      </span>
      <span className="hljs-comment">;</span>
      {"\n"}
      {"    "}
      <span className="hljs-keyword">jokes.forEach(({"{"} </span>
      <span className="hljs-keyword">joke </span>
      {"}"}) =&gt; {"{"}
      {"\n"}
      {"        "}contentString += `- **${"{"}
      <span className="hljs-keyword">
        joke{"}"}**\n`;{"\n"}
      </span>
      {"    "}
      {"}"})<span className="hljs-comment">;</span>
      {"\n"}
      {"    "}return {"{"}
      {"\n"}
      <span className="hljs-symbol">{"        "}type:</span>{" "}
      InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
      {"\n"}
      <span className="hljs-symbol">{"        "}data:</span> {"{"}
      {"\n"}
      <span className="hljs-symbol">{"        "}content:</span> contentString,
      {"\n"}
      {"        "}
      {"}"},{"\n"}
      {"}"}
      <span className="hljs-comment">;</span>
      {"\n"}
    </code>
  </pre>
  <p>
    So, in the code above, we are performing a simple <code>SELECT</code> query
    on the jokes table to get 5 jokes of the user provided as an option in the
    command. If the user has not posted any jokes, we reply with "User has not
    posted any jokes ðŸ˜•". Else, we display the jokes posted by that user.
  </p>
  <p>
    We also add a simple default case to handle any invalid application command.
  </p>
  <p>
    The full code for this file and the <code>helpers/commands.js</code> file is
    located{" "}
    <a href="https://gist.github.com/geekysrm/1df4247baa3f74ee8b75fe1cbb8908be">
      here
    </a>{" "}
    .
  </p>
  <h2 id="deploying-to-cloud-instance">Deploying to Cloud Instance</h2>
  <p>
    As said above, all the code and data above are present in our local instance
    i.e. our local machine. Now let's move the code to the cloud, so that anyone
    can use it anytime.
  </p>
  <p>
    Luckily for us, HarperDB makes it quite easy to deploy our local instance to
    the cloud. Just a couple clicks, and we are done.
  </p>
  <p>Let's start.</p>
  <p>
    First, go to the HarperDB Studio Instances page and let's create a cloud
    instance: Let's name it <code>cloud</code> and choose all the FREE options:
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633448547165/8JjPidALI.png"
      alt="tmpDLNeSa.png"
    />
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633448658293/Gdv3oEoeQ.png"
      alt="tmploR_67.png"
    />
  </p>
  <p>Wait for some time till our Cloud Instance is being created.</p>
  <p>
    Upon successful creation, create a new schema <code>dev</code> and 2 tables
    for that schema called <code>users</code> , <code>jokes</code> just like we
    did for our local instance.
  </p>
  <p>
    Now switch to the <strong>functions</strong> tab, and click on{" "}
    <strong>Enable Custom Functions</strong>. Then,
  </p>
  <p>
    Let's switch back to our local instance now. Go to the{" "}
    <strong>functions</strong> tab and you can see a <strong>deploy</strong>{" "}
    button on the top right.
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633449748531/tlrVpBr7Q.png"
      alt="tmpZdma3K.png"
    />
  </p>
  <p>
    Click on <strong>deploy</strong> and you will come across a screen like
    this:
  </p>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633450068931/Vzf_L5OJo.png"
      alt="tmp9jnq8n.png"
    />
  </p>
  <p>
    Click the green <strong>deploy</strong> button to deploy your <em>local</em>{" "}
    custom functions to your <em>cloud</em> instance.
  </p>
  <p>Wait for some time. And done!</p>
  <p>
    Now our cloud functions are deployed on the cloud. Yes it's <em>that</em>{" "}
    easy!
  </p>
  <h2 id="using-our-cloud-instance">Using our cloud instance</h2>
  <p>
    Now that we have deployed our functions code to the cloud, we can now setup
    our Discord Bot to use this cloud URL instead of the <code>ngrok</code> URL
    which was basically our local instance.
  </p>
  <p>
    Go to{" "}
    <a href="https://discord.com/developers/applications">
      Discord Developers Portal
    </a>{" "}
    and then click on your application. On the{" "}
    <strong>General Information</strong> tab, replace the{" "}
    <strong>Interactions Endpoint URL</strong> with the following:
  </p>
  <p>
    <code>YOUR_HARPERDB_CLOUD_INSTANCE_URL/discordbot</code>
  </p>
  <p>
    <em>
      If you named your custom functions project something else, replace{" "}
      <code>discordbot</code> with the project name.
    </em>
  </p>
  <p>You should see a Success Message.</p>
  <h2 id="discord-bot-demo">Discord Bot Demo</h2>
  <p>
    Now that it's deployed, go ahead and post some programming/dev jokes using{" "}
    <code>/sayjoke</code> command, find out if you are the topper with the max
    number of jokes using <code>/top</code> command or use{" "}
    <code>/listjokes</code> to find jokes posted by a particular user.
  </p>
  <p>Here's our bot in action:</p>
  <h3 id="-sayjoke-joke-">
    /sayjoke <code>&lt;joke&gt;</code>
  </h3>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633450637123/xSl_7xesG.png"
      alt="say joke demo.png"
    />
  </p>
  <h3 id="-top">/top</h3>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633450652073/nkR5qxY2O.png"
      alt="top demo.png"
    />
  </p>
  <h3 id="-listjokes-user-">
    /listjokes <code>&lt;user&gt;</code>
  </h3>
  <p>
    <Image
      src="https://cdn.hashnode.com/res/hashnode/image/upload/v1633461684086/1fQbiDJB6.png"
      alt="tmpCQ3xWQ.png"
    />
  </p>
  <p>Yay! ðŸŽ‰ðŸš€ Congratulations! Our bot works as expected!</p>
  <h2 id="conclusion">Conclusion</h2>
  <p>
    I hope this example helped you understand how easy it is to get started
    building APIs using the new Custom Functions feature from HarperDB.
  </p>
  <p>
    The custom functions also support{" "}
    <a href="https://harperdb.io/docs/custom-functions/host-a-static-web-ui/">
      static site hosting
    </a>{" "}
    . So you can use Vanilla HTML, CSS, JS or frameworks like React, Vue,
    Angular etc to create and host your static sites. We can cover this feature
    in a future tutorial!
  </p>
  <p>Hope you have fun developing using HarperDB Custom Functions.</p>
  <h3 id="further-documentation-">Further documentation:</h3>
  <ul>
    <li>
      <a href="https://harperdb.io/docs/custom-functions/">
        HarperDB Custom Functions docs
      </a>
    </li>
    <li>
      <a href="https://harperdb.io/docs/getting-started/">
        Getting started with HarperDB
      </a>
    </li>
  </ul>
  <h2 id="happy-coding-">Happy Coding! ðŸ‘¨â€ðŸ’»</h2>
  <p>
    <em>
      If this post helped you, and you want to help me create more tutorials/
      videos like this, please consider supporting me at{" "}
      <a href="https://coffee.soumya.dev/">https://coffee.soumya.dev/</a>
    </em>
  </p>
</div>
